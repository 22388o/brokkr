# Brokkr

A Python package to receive science data and status information from a local HAMMA2 lightning sensor and a Sunsaver MPPT-15L charge controller, store it locally, and transmit it back to a central server (generally, but not necessarily one running the Sindri package).
Further, it can maintain a reverse SSH tunnel to an accessible server for remote access, and receive and execute power, processing system and sensor control commands forwarded as custom binary TCP packets over said connection.



## Installation and Setup

Built and tested under Python 3.7 (but should be compatible with Python >=3.6; lack thereof should be considered a bug) and recent (>= 2019) versions of the packages listed in the `requirements.txt` file.

To read in data from the charge controller, the same must be connected via the serial to USB adapter, the Python packages ``pymodbus`` and ``pyserial`` are required, and if on most Linux systems, the following command must be run at some point after installing the system and creating an account to ensure the user is added to the correct permissions group to access the serial ports (make sure to log out and log back in after doing so):

```bash
sudo usermod -a -G dialout $USER
```

## Configuration

Configuration files are located under the XDG-standard ``~/.config/brokkr`` directory in the ini-like [TOML](https://github.com/toml-lang/toml) format; they can be generated by running `brokkr` once or by the installation script.
Everything but the ``local.toml`` config will be updated automatically from the server, but the default settings in the ``network.toml`` and ``site.toml`` files should be edited to ensure optimum behavior in case the Internet is down or the server is not configured on first run.
To temporarily override the centrally-managed settings with local ones, configure the appropriate settings in `local.toml` and set its ``override`` to ``true``.
