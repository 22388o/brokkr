# Brokkr

A Python package to receive science data and status information from a local HAMMA2 lightning sensor and a Sunsaver MPPT-15L charge controller, store it locally, and transmit it back to a central server (generally, but not necessarily one running the Sindri package).
Further, it can maintain a reverse SSH tunnel to an accessible server for remote access, and receive and execute power, processing system and sensor control commands forwarded as custom binary TCP packets over said connection.



## Installation and Setup

Built and tested under Python 3.7 (but should be compatible with Python >=3.6; lack thereof should be considered a bug) and recent (>= 2019) versions of the packages listed in the `requirements.txt` file.
It works best on Linux, but is tested to be fully functional (aside from service features) on Windows (and should work equally macOS) under the Anaconda distribution.

Following standard installation via ``pip`` (``venv`` highly recommended), the package will install the ``brokkr`` command, which controls installation (``brokkr install-service``)  and manual execution (via ``brokkr start``) of the brokkr client on all platforms.
On reasonably modern Linux systems with ``systemd``, the ``brokkr install-service`` command will automatically install the client to run automatically as a service on startup with the rights of the current user (which can be controlled via the normal ``systemctl`` commands as well as the installed unit file).
On Linux (not on Windows, and untested on macOS) you will need to add your user account to the correct group to access the serial ports, which can be done via the command

```bash
sudo usermod -a -G dialout $USER
```

Make sure to log out and back in after running the above command, so the correct rights get added to your account.



## Configuration

Configuration files are located under the XDG-standard ``~/.config/brokkr`` directory in the ini-like [TOML](https://github.com/toml-lang/toml) format; they can be generated by running `brokkr` once or by the installation script.
Everything but the ``local.toml`` config will be updated automatically from the server, but the default settings in the ``network.toml`` and ``site.toml`` files should be edited to ensure optimum behavior in case the Internet is down or the server is not configured on first run.
To temporarily override the centrally-managed settings with local ones, configure the appropriate settings in `local.toml` and set its ``override`` to ``true``.
